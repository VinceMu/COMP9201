Part1.The critical area here is counter, in order to protect this area, lock_c is created before forking multiple threads. Then each time, a thread need to require a lock before it can get access to counter, and after running, it releases lock_c.Part2.To prevent deadlock, a circle of locks need to be omitted. By making a chain of locks in fixed order, a thread have to get the former lock before it can try the next one, thus deadlock is prevented. So change both functionsâ€™ lock sequence to lock_a then lock_b fixed the deadlock problem.
